<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>
      ESP8266 Temperature Display &middot; Rémy G
  </title>
  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />
  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />
  <!-- Additional head bits without overriding original head -->
</head>
  <body class="rg-post">
    <div id="sidebar">
  <header>
    <div class="site-title">
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        Rémy G
    </div>
    <p class="lead">Blog of a software developer
</p>
  </header>
  <nav id="sidebar-nav-links">
    <a class="home-link "
        href="/">Home</a>
  <a class="page-link" href="/blog/">Blog</a>
    <a class="page-link "
        href="/projects/">Projects</a>
  <!-- Optional additional links to insert in sidebar nav -->
<a class="page-link" href="/about/">About Me</a>
<a class="page-link" href="/contact/">Contact</a>
</nav>
  <nav id="sidebar-icon-links">
  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags/">
      <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Tags"
       href="/search/">
      <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  <!-- Optional additional links to insert for icons links -->
<a id="github-link"
   class="icon"
   title="Github" aria-label="Tags"
   href="https://github.com/remyg">
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>
</a>
<a id="twitter-link"
   class="icon"
   title="Twitter" aria-label="Tags"
   href="https://twitter.com/remygardette">
  <svg viewbox="0 0 512 512"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"/></svg>
</a>
</nav>
  <p>
  &copy; 2018.
  <a href="/license">License.</a>
</p>
</div>
    <main class="container">
      <header>
  <h1 class="post-title">ESP8266 Temperature Display</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">01 May 2018</span>
  <span class="post-categories">
      &bull;
        blog
      &bull;
        <a href="/category/development/">
          Development
        </a>
  </span>
</div>
  <div class="post-body">
    <p>In this article, I’ll explain how to make a temperature sensor and display, using an ESP8266 board, a DS18B20 temperature sensor and an I2C LCD display.</p>
<p>The WiFi capabilities of the ESP8266 are not required in this project, but I intent to send the temperature values to an MQTT instance in a future version.</p>
<h2 id="items">Items</h2>
<ul>
  <li>ESP8266 development board</li>
  <li>DS18B20 temperature sensors</li>
  <li>I2C LCD 16x2 display</li>
  <li>4.7K resistor</li>
  <li>breadboard</li>
  <li>jumper wires</li>
</ul>
<!--more-->
<h2 id="wiring">Wiring</h2>
<p>The wiring for this project is quite simple.</p>
<ul>
  <li>The DS18B20 sensor DATA pin is wired to the ESP8266 D3 pin.</li>
  <li>The LCD I2C SDA pin is wired to the ESP8266 D4 pin, and the SCL pin to the D5 pin.</li>
</ul>
<p><img src="https://d1u9a15udaub9r.cloudfront.net/esp8266-ds18b20-wiring.png" alt="Wiring" /></p>
<h2 id="code">Code</h2>
<p>You need 3 libraries for this project :</p>
<ul>
  <li><a href="https://github.com/PaulStoffregen/OneWire">OneWire</a></li>
  <li><a href="https://github.com/milesburton/Arduino-Temperature-Control-Library">DallasTemperature</a></li>
  <li><a href="https://github.com/marcoschwartz/LiquidCrystal_I2C">LiquidCrystal_I2C</a></li>
</ul>
<p>You can find the code on GitHub <a href="https://github.com/RemyG/iot-temp-to-lcd">here</a>.</p>
<p>In the <code class="highlighter-rouge">setup</code>, we initialize the one-wire bus, the temperature sensor, and the LCD.</p>
<p>In the <code class="highlighter-rouge">loop</code>, we get the temperature, and display it on the LCD if its value changed since the last loop.</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;LiquidCrystal_I2C.h&gt;
#include &lt;DallasTemperature.h&gt;
#include &lt;OneWire.h&gt;
</span>
<span class="c1">// Data wire is plugged into pin D3 on the ESP8266</span>
<span class="cp">#define ONE_WIRE_BUS D3
</span>
<span class="c1">// LCD pins</span>
<span class="cp">#define SDA_PIN D4
#define SCL_PIN D5
</span>
<span class="cp">#define TEMP_SIZE 7
</span>
<span class="c1">// Setup a oneWire instance to communicate with any OneWire devices</span>
<span class="n">OneWire</span> <span class="n">oneWire</span><span class="p">(</span><span class="n">ONE_WIRE_BUS</span><span class="p">);</span>

<span class="c1">// Pass our oneWire reference to Dallas Temperature.</span>
<span class="n">DallasTemperature</span> <span class="n">DS18B20</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oneWire</span><span class="p">);</span>

<span class="kt">char</span> <span class="n">temperatureCString</span><span class="p">[</span><span class="n">TEMP_SIZE</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">previousTemp</span><span class="p">[</span><span class="n">TEMP_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="s">"init"</span><span class="p">;</span>

<span class="n">LiquidCrystal_I2C</span> <span class="n">lcd</span><span class="p">(</span><span class="mh">0x27</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// The I2C address may be different in your project, see the notes below.</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>

  <span class="n">Wire</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">SDA_PIN</span><span class="p">,</span> <span class="n">SCL_PIN</span><span class="p">);</span>

  <span class="n">lcd</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">backlight</span><span class="p">();</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"HELLO"</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"WORLD"</span><span class="p">);</span>

  <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>

  <span class="n">DS18B20</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>

  <span class="n">lcd</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Temp.:"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">getTemperature</span><span class="p">()</span> <span class="p">{</span>

  <span class="kt">float</span> <span class="n">tempC</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">DS18B20</span><span class="p">.</span><span class="n">requestTemperatures</span><span class="p">();</span>
    <span class="n">tempC</span> <span class="o">=</span> <span class="n">DS18B20</span><span class="p">.</span><span class="n">getTempCByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">dtostrf</span><span class="p">(</span><span class="n">tempC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">temperatureCString</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tempC</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">127</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">tempC</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mf">127.0</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>

  <span class="n">getTemperature</span><span class="p">();</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">temperatureCString</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">previousTemp</span><span class="p">,</span><span class="n">temperatureCString</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">setCursor</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">lcd</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">temperatureCString</span><span class="p">);</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">previousTemp</span><span class="p">,</span> <span class="n">temperatureCString</span><span class="p">,</span> <span class="n">TEMP_SIZE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="notes">Notes</h2>
<p>If nothing appears on the LCD, it could be due to several factors:</p>
<ul>
  <li>the I2C board has a contrast adjustment potentiometer, which looks like a screw in a small blue cube on the back of the board.</li>
  <li>the I2C address used in the command <code class="highlighter-rouge">LiquidCrystal_I2C lcd(0x27, 16, 2);</code> (<code class="highlighter-rouge">0x27</code>) may be different for you, preventing anything to be displayed on the LCD. If it’s the case, you can find several I2C address scanner projects to run on your board (eg. on <a href="http://www.instructables.com/id/ESP8266-I2C-PORT-and-Address-Scanner/">Instructables</a>).</li>
</ul>
<div class="post-tags">
    <a href="/tags/#iot">
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">IoT</span>
    </a>
    <a href="/tags/#domotics">
      <span class="icon">
        <svg fill="#000000" height="24" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">domotics</span>
    </a>
</div>
    <footer>
      <a href="https://remyg.fr/about/#want-to-help" class="btn btn-support">Support me</a>
    </footer>
  </div>
  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
      <li>
        <h3>
          <a href="/blog/2018/07/29/nginx-reverse-proxy/">
            NGINX Reverse Proxy
            <small>29 Jul 2018</small>
          </a>
        </h3>
      </li>
      <li>
        <h3>
          <a href="/blog/2018/05/13/sending-temperature-data-from-esp8266-to-mqtt/">
            Sending temperature data from an ESP8266 to MQTT
            <small>13 May 2018</small>
          </a>
        </h3>
      </li>
      <li>
        <h3>
          <a href="/blog/2017/12/31/generating-secure-passwords/">
            Generating secure passwords
            <small>31 Dec 2017</small>
          </a>
        </h3>
      </li>
  </ul>
</section>
</div>
    </main>
    <!-- Optional footer content -->
  </body>
</html>
